$def with (name)

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="shortcut icon" href="bootstrap/docs-assets/ico/favicon.png">

  <!-- Bootstrap core CSS -->
  <link href="bootstrap/dist/css/bootstrap.css" rel="stylesheet">

  <style type="text/css">
    /* This is the id that should be used by tts text*/
    .notice { font-size: 60px; }
  </style>

		
</head>

    <!-- jQuery and display.js are conveniences for interacting with the DOM -->
    <script src="js/jquery.js"></script>
    <script src="js/display.js"></script>

    <script type="text/javascript" src="js/jquery-ui.js"></script>

    <!-- ROSLIBJS -->
    <!-- EventEmitter2 is the sole dependency of roslibjs -->
    <script src="roslibjs/include/EventEmitter2/eventemitter2.js"></script>
    <!-- Roslibjs handles core ROS functionality in the browser -->
    <script src="roslibjs/build/roslib.js"></script>

    <!-- ROS2DJS -->
    <!-- EaselJS is a dependency of ros2djs -->
    <script src="ros2djs/include/EaselJS/easeljs.js"></script>
    <!-- Ros2djs provides 2D scene support, including mapping and more -->
    <script src="ros2djs/build/ros2d.js"></script>

    <!-- ROS3DJS -->
    <!-- Three.js is the WebGL rendering library -->
    <script src="ros3djs/include/threejs/three.js"></script>
    <!-- ColladaLoader2 loads collada models of the robot -->
    <script src="ros3djs/include/ColladaAnimationCompress/ColladaLoader2.js"></script>
    <!-- Ros3djs provides 3D scene support, including mapping and more -->
    <script src="ros3djs/build/ros3d.min.js"></script>

    <script src="nav2djs/build/nav2d.js"></script> 


    <script src="bootstrap/dist/js/bootstrap.js"></script>

	<body style="margin:0px;padding:0px;overflow:hidden">

	<!--	data-toggle="modal" data-target="#emergency_dlg" 
    <iframe id="content" src="http://www.google.com" frameborder="0" style="overflow:hidden;overflow-x:hidden;overflow-y:hidden;height:100%;width:100%;position:absolute;top:0px;left:0px;right:0px;bottom:0px" height="100%" width="100%"></iframe> -->
    
    <div class="container">

    <div style="z-index: 9999;" id="header">
    	<a onclick="console.log('emergency');$$('#emergency_dlg').modal('show');">
            <img width="32px" style="position:absolute; right: 1px; top:1px;z-index: 9999;  -webkit-filter: drop-shadow(-5px 5px 3px #222);
  filter: drop-shadow(-5px 5px 3px #222);
"src="static/emergency-stop.png">
        </a>
    </div>

    <!-- <div id="content" style="width: 100%; height: 100%;"> -->
    <div id="content">
        <p> If you can see this, something is wrong ;)</p>
        <p> Often this means that this page can't reach rosbrige.</p>
    </div>

</div>





<script type="text/javascript" type="text/javascript">
            // Connecting to ROS
            // -----------------
            var display_number = -1;
            var page_topic;

            var hostname = location.hostname;

            var ros = new ROSLIB.Ros({
                // this is filled by the ros node when writing this page to the web server, but doesn't currently work
                // url : '<dynamic>bridge_server</dynamic>'
                url : 'ws://'+hostname+':9090'
            });

            function call_service(s) {
                // Register the display with the manager
                var client = new ROSLIB.Service({
                    ros : ros,
                    name : s,
                    serviceType : 'std_srvs/Empty'
                });

                var request = new ROSLIB.ServiceRequest({});

                console.log("Calling service....", s);
                client.callService(request);
            }

            var setup = function() {
                // Subscribing to page topic
                // -------------------------
                console.log("Trying to setup");
                page_topic = new ROSLIB.Topic({
                    ros : ros,
                    name : '$:name/display_' + window.display_number + '/page',
                    messageType : 'std_msgs/String'
                });
                page_topic.subscribe(function(message) {
                    //if message.data.beg
                    if (message.data.indexOf("http") == 0) {
                        // we have a URL so wrap in iframe...
                        document.getElementById("content").innerHTML = "<iframe src=\"" + message.data
                                + "\" frameborder=\"0\" style=\"overflow:hidden;overflow-x:hidden;overflow-y:hidden;height:100%;width:100%;position:absolute;top:0px;left:0px;right:0px;bottom:0px\" height=\"100%\" width=\"100%\"></iframe> ";
                    } else {
                        // some html content
                        var content = document.getElementById("content");
                        content.innerHTML = message.data;
                        eval(content.innerHTML)
                        // console.log(message.data)
                    }

                });
                register_model_dlg_topic();

					  this.modalDlgServer = new ROSLIB.SimpleActionServer({
					    ros : ros,
					    serverName : '/strands_webserver/modal_dialog',
					    actionName : 'strands_webserver/ModalDialogSrvAction'
					  });
					  var that=this;

					  this.modalDlgServer.on('goal', function(goalMessage) {
					      //that.modalDlgServer.sendFeedback('displayed');
			              document.getElementById("modal-title").innerHTML=goalMessage.title;
			              document.getElementById("modal-text").innerHTML=goalMessage.text;
			              var btn_str = "";
			              var btns = goalMessage.buttons;
			              var btn_cls = goalMessage.buttons_class;
			              var cls = "btn-default";
			              for (var i in btns) {
			              	if (i < btn_cls.length) {
			              		cls = btn_cls[i];
			              	} else {
			              		cls = "btn-default";
			              	}

			              	btn_str += "<button name=\"" + i + "\" id=\"button_" + i + "\" type=\"button\" class=\"btn " + cls + "\">" + btns[i] + "</button>";
			              }
			              document.getElementById("modal-buttons").innerHTML=btn_str;
			              for (var i in btns) {
				              $$('#button_' + i).on('click', function(e) {
				              	var result = { button: e.currentTarget.innerHTML, button_id: Number(e.currentTarget.name)};
		  		                clearTimeout($$('#modal_dlg').data('hideInterval'));
		                        $$('#modal_dlg').modal('hide');
				              	that.modalDlgServer.setSucceeded(result);
				              });
			              }
			              // clear timeout
			              clearTimeout($$('#modal_dlg').data('hideInterval'));
			              // show dialog
	                      $$('#modal_dlg').modal({backdrop: 'static', keyboard: false});
	                      if (goalMessage.timeout > 0) {
					          $$('#modal_dlg').data('hideInterval', setTimeout(function(){
							  	console.log('timeout modal dialog')
		                        $$('#modal_dlg').modal('hide');
							  	that.modalDlgServer.setPreempted();
					          }, goalMessage.timeout * 1000));
				  		  }
			              var feedback = { feedback: document.getElementById("modal_dlg").innerHTML };
      					  that.modalDlgServer.sendFeedback(feedback);
					    
						  //send result
						  //var result = { sequence: fibonacciSequence};
						  //that.modalDlgServer.setSucceeded(result);
					  });
					  this.modalDlgServer.on('cancel', function(goalMessage){
					  	console.log('hide modal dialog')
  		                clearTimeout($$('#modal_dlg').data('hideInterval'));
                        $$('#modal_dlg').modal('hide');
					  	that.modalDlgServer.setPreempted();
					  });                





                document.getElementById("content").innerHTML = "Ready; display = "+window.display_number;
            }

            var shutdown = function () {
                page_topic.unsubscribe();
                console.log("Stoped subscription.");
            }


          function register_model_dlg_topic() {
            var dlgTopic = new ROSLIB.Topic({
                ros : ros,
                name : '$:name/modal_dialog',
                messageType : 'strands_webserver/ModalDlg'
            });
            console.log("register DLG");
            dlgTopic.subscribe(function(message) {
                // Formats the pose for outputting.
                document.getElementById("modal-body-title").innerHTML=message.title;
                document.getElementById("modal-body-text").innerHTML=message.content;

                if (message.show) {
                    $$('#notification_dlg').modal({backdrop: 'static', keyboard: false});
                }
                else {
                    $$('#notification_dlg').modal('hide');
                }

            });
            console.log("register DLG done");

          }



            // Register the display with the manager
            var registerDisplayClient = new ROSLIB.Service({
                ros : ros,
                name : '$:name/register_display',
                serviceType : 'strands_webserver/RegisterDisplay'
            });

            var request = new ROSLIB.ServiceRequest({});

            console.log("Calling service....");
            registerDisplayClient.callService(request, function(result) {
                window.display_number = result.display_number;
                console.log("Registered => " + result.display_number);

                setup();
            });

            window.onbeforeunload = function() {
                shutdown();
                var unregisterDisplayClient = new ROSLIB.Service({
                    ros : ros,
                    name : '$:name/unregister_display',
                    serviceType : 'strands_webserver/UnregisterDisplay'
                });

                var request = new ROSLIB.ServiceRequest({
                    "display_number" : window.display_number
                });

                unregisterDisplayClient.callService(request, function(result) {
                    console.log("Done.");
                });
            }


        </script>

<div class="modal fade" id="notification_dlg">
  <div class="modal-dialog">
    <div class="modal-content" >
      <div class="modal-header">
        <!--<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>-->
        <h4 class="modal-title"><div id="modal-body-title">Notification</div></h4>
      </div>
      <div class="modal-body">
        <div id="modal-body-text"></div>
      </div>
<!--       <div class="modal-footer">
        <button onclick="emergency_stop();" type="button" class="btn btn-danger btn-default" data-dismiss="modal">Notfall auslösen</button>
        <button type="button" class="btn" data-dismiss="modal">Zurück zum Normalbetrieb</button>
      </div>
 -->    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div>

<div class="modal fade" id="emergency_dlg">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Notfall-Progamm aktivieren?</h4>
      </div>
      <div class="modal-body">
        <p>Soll wirklich ein Notfall-Stop ausgelöst werden? Der Roboter wird seine Arbeit unverzüglich einstellen und kann danach frei bewegt werden. Diese Funktion sollte <i>wirklich nur im Notfall</i> verwendet werden. Ein Aktivierung wird dem Robot-Wartungs-Team gemeldet. Bitte informieren Sie nach der Aktivierung die Rezeption, damit zu einem späteren Zeitpunkt der Betrieb wieder aufgenommen werden kann.</p>
      </div>
      <div class="modal-footer">
        <button onclick="call_service('/safety_stop');" type="button" class="btn btn-link btn-sm" data-dismiss="modal">
        <img width="32px" style="-webkit-filter: drop-shadow(-2px 2px 1px #222);
  filter: drop-shadow(-2px 2px 1px #222);
"src="static/emergency-stop.png"> Notfall auslösen</button>
        <button type="button" class="btn-success btn btn-lg" data-dismiss="modal"><b>Zurück zum Normalbetrieb</b></button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div class="modal fade" id="modal_dlg">
  <div class="modal-dialog">
    <div class="modal-content" >
      <div class="modal-header">
        <!--<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>-->
        <h4 class="modal-title"><div id="modal-title">Notification</div></h4>
      </div>
      <div class="modal-body">
        <div id="modal-text"></div>
      </div>
      <div class="modal-footer">
      	<div id="modal-buttons">
        <!--<button onclick="emergency_stop();" type="button" class="btn btn-danger btn-default" data-dismiss="modal">Notfall auslösen</button>
        <button type="button" class="btn" data-dismiss="modal">Zurück zum Normalbetrieb</button>-->
        </div>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div>

	</body>
</html>
